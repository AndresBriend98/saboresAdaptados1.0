<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Pacientes</title>
    <link rel="icon" href="assets/images/faviicon/favicon.ico" />
    <!-- for icons  -->
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
    <!-- bootstrap  -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <!-- for swiper slider  -->
    <link rel="stylesheet" href="assets/css/swiper-bundle.min.css">
    <!-- fancy box  -->
    <link rel="stylesheet" href="assets/css/jquery.fancybox.min.css">
    <!-- custom css  -->
    <link rel="stylesheet" href="assets/css/style.css">
    <!-- chatbot css  -->
    <link rel="stylesheet" href="chatbot/css/chat.css">
    <!-- font awesome-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <style>
        /* Estilo para la barra de progreso verde */
        .progress-bar-green {
            background-color: #28a745;
            /* Verde para éxitos o procesos en marcha */
        }

        /* Estilo para la barra de progreso roja */
        .progress-bar-red {
            background-color: #dc3545;
            /* Rojo para indicar error */
        }

        /* Ajustar la altura de la sección para centrar verticalmente */
        .main-banner {
            min-height: 80vh;
            /* Ajustar según sea necesario */
            display: flex;
            align-items: center;
            /* Centrar verticalmente */
            justify-content: center;
            /* Centrar horizontalmente */
            background-image: url("assets/images/background/blog-pattern-bg.png");
        }

        .sec-wp {
            text-align: center;
            /* Centrar el contenido del texto */
        }

        .form-container {
            width: 100%;
            /* Ajustar el ancho del formulario */
            margin: 0 auto;
            /* Centrar el contenedor */
            background: rgba(255, 255, 255, 0.8);
            /* Fondo translúcido */
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            /* Sombra suave para el formulario */
        }

        /* Estilo para el botón con hover y transición suave */
        .btn-red {
            background-color: #ff8243;
            color: white;
            border: none;
            transition: background-color 0.3s;
            /* Transición suave para el hover */
        }

        /* Efecto hover para el botón */
        .btn-red:hover {
            background-color: rgb(224, 93, 6);
            /* Color más oscuro al pasar el cursor */
            color: white;
            /* Mantener el color del texto */
            transform: scale(1.05);
            /* Un pequeño efecto de escala para animación */
        }
    </style>
</head>

<body>
    <!-- Header  -->
    <header class="site-header">
        <div class="container">
            <div class="row">
                <div class="col-lg-2 mt-4">
                    <div class="header-logo">
                        <img src="assets/images/logo.png" width="300" height="100" alt="Logo">
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Home  -->
    <div id="viewport">
        <div id="js-scroll-content">
            <section class="main-banner" id="home"
                style="background-image: url(assets/images/background/blog-pattern-bg.png);">
                <div class="book-table-shape">
                    <img src="assets/images/background/table-leaves-shape.png" alt="">
                </div>

                <div class="book-table-shape book-table-shape2">
                    <img src="assets/images/background/table-leaves-shape.png" alt="">
                </div>
                <div class="js-parallax-scene">
                    <div class="banner-shape-1 w-100" data-depth="0.30">
                        <img src="assets/images/background/berry.png" alt="">
                    </div>
                    <div class="banner-shape-2 w-100" data-depth="0.25">
                        <img src="assets/images/background/leaf.png" alt="">
                    </div>
                </div>
                <div class="sec-wp">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="banner-text">
                                <p class="sec-sub-title mb-3">Iniciar Sesión</p>
                                <h2 class="h2-title">Pacientes</h2>
                                <div class="sec-title-shape mb-4">
                                    <img src="assets/images/figure/title-shape.svg" alt="">
                                </div>
                                <div class="sec-title-shape mb-4">
                                    <img src="assets/images/title-shape.svg" alt="">
                                </div>
                            </div>
                            <div class="form-container">
                                <form id="patient-login-form">
                                    <div class="form-group">
                                        <label for="patient-dni">DNI</label>
                                        <input type="text" id="patient-dni" class="form-control" required>
                                    </div>
                                    <button type="submit" class="btn btn-red mt-4">Iniciar Sesión</button>
                                </form>
                                <div id="patient-login-message"></div>
                            </div>
                            <!-- Barra de progreso para el proceso de login -->
                            <div id="loginProgressBar" class="progress" style="height: 5px; display: none;">
                                <div class="progress-bar progress-bar-striped progress-bar-animated progress-bar-green"
                                    role="progressbar" style="width: 0%;">
                                </div>
                            </div>

                            <!-- Mensaje de éxito para el login -->
                            <div id="loginSuccessMessage" class="alert alert-success" style="display: none;">
                                Iniciando sesión...
                            </div>

                            <!-- Mensaje de error para el login -->
                            <div id="loginErrorMessage" class="alert alert-danger" style="display: none;">
                                Error al iniciar sesión.
                            </div>
                            <!-- Mensaje para el proceso de cierre de sesión -->
                            <div id="logoutMessage" class="alert alert-success" style="display: none;">
                                Cerrando sesión...
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!--ESTE FOOTER FUNCIONA PERFECTAMENTE!-->
            <!-- Footer -->
            <footer class="site-footer" id="contact"
                style="background-image: url(assets/images/background/blog-pattern-bg.png);">
                <div class="bottom-footer">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12 text-center">
                                <div class="copyright-text">
                                    <p>Copyright &copy; 2024 <span class="name">Sabores Adaptados</span> All Rights
                                        Reserved.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>
        </div>

    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script>
        $("#patient-login-form").on("submit", function (e) {
            e.preventDefault(); // Evitar comportamiento predeterminado del formulario

            const dni = $("#patient-dni").val();

            // Mostrar el mensaje de inicio de sesión y la barra de progreso verde
            $("#loginSuccessMessage").slideDown();
            $("#loginProgressBar").show();
            $("#loginProgressBar .progress-bar")
                .removeClass("progress-bar-red") // Quitar cualquier clase roja
                .addClass("progress-bar-green") // Asegurarse de tener clase verde
                .animate({ width: "100%" }, 2000); // Animar la barra verde

            $.post("/patient/login", { dni }, function (data) {
                // Redirigir después de 2 segundos si el login es exitoso
                setTimeout(function () {
                    window.location.href = `/home-patient.html?dni=${dni}`;
                }, 2000);
            }).fail(function (xhr) {
                // Mostrar la barra de progreso roja para errores
                $("#loginProgressBar").show();
                $("#loginProgressBar .progress-bar")
                    .removeClass("progress-bar-green") // Quitar clase verde
                    .addClass("progress-bar-red") // Añadir clase roja
                    .css("width", "100%"); // Barra llena para error

                // Mostrar el mensaje de error
                $("#loginErrorMessage").text(
                    xhr.status === 404 ? "DNI no registrado." : "Error al iniciar sesión. Intenta de nuevo."
                ).slideDown(); // Mostrar el mensaje de error

                // Ocultar el mensaje de inicio de sesión
                $("#loginSuccessMessage").slideUp(); // Ocultar mensaje de éxito
            });
        });
        $("#logout-button").on("click", function (e) {
            e.preventDefault(); // Evitar comportamiento predeterminado si es necesario

            // Mostrar el mensaje "Cerrando sesión..." y la barra de progreso verde
            $("#logoutMessage").slideDown();
            $("#logoutProgressBar").show();
            $("#logoutProgressBar .progress-bar")
                .removeClass("progress-bar-red") // Asegurarse de quitar la clase roja
                .addClass("progress-bar-green") // Asegurarse de tener clase verde
                .animate({ width: "100%" }, 2000); // Animar la barra verde

            $.post("/logout", function (data) {
                // Redirigir después de 2 segundos
                setTimeout(function () {
                    window.location.href = "/index.html"; // Redirigir a la página principal
                }, 2000);
            }).fail(function (xhr) {
                // Mostrar la barra de progreso roja para errores
                $("#logoutProgressBar").show();
                $("#logoutProgressBar .progress-bar")
                    .removeClass("progress-bar-green") // Quitar la clase verde
                    .addClass("progress-bar-red") // Añadir la clase roja
                    .css("width", "100%"); // Llenar completamente para indicar error

                // Mostrar el mensaje de error
                $("#logoutMessage").text("Error al cerrar sesión. Por favor, intente de nuevo.").slideDown();
            });
        });
    </script>


    <script>
        window.addEventListener("scroll", function () {
            const scrollTopButton = document.querySelector(".scrolltop");
            if (window.scrollY > 100) { // Si se desplaza más de 100px, mostrar el botón
                scrollTopButton.style.opacity = 1; // Hacer visible el botón
            } else {
                scrollTopButton.style.opacity = 0; // Ocultar el botón
            }
        });

        // Evento para hacer scroll hacia arriba cuando se hace clic en el botón
        document.querySelector(".scrolltop").addEventListener("click", function () {
            window.scrollTo({ top: 0, behavior: "smooth" }); // Scroll suave hacia arriba
        });

        $(document).ready(function () {
                $("a[href='index.html']").on("click", function (e) {
                    e.preventDefault(); // Evitar la redirección automática

                    // Mostrar el contenedor con el mensaje y la barra de progreso
                    $("#logoutNotificationContainer").slideDown(); // Mostrar el mensaje de cierre de sesión

                    // Animar la barra de progreso para el cierre de sesión
                    $("#logoutProgressBar .progress-bar")
                        .removeClass("progress-bar-red")
                        .addClass("progress-bar-green")
                        .animate({ width: "100%" }, 2000);

                    // Llamar al endpoint de cierre de sesión
                    $.post("/logout", function () {
                        // Redirigir después de cerrar sesión
                        setTimeout(function () {
                            window.location.href = "index.html"; // Página a la que redirige después de cerrar sesión
                        }, 2000);
                    });
                });

            });

            window.history.replaceState({}, "", "index.html"); // Reemplazar el estado actual del historial

            window.addEventListener("pageshow", function (e) {
                if (e.persisted) {
                    window.location.href = "index.html"; // Redirigir si el usuario intenta volver
                }
            });
    </script>
    <!--google librarie-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <!--recipes-->
    <script src="assets/js/recipes.js"></script>

    <!-- jquery  -->
    <script src="assets/js/jquery-3.5.1.min.js"></script>

    <!-- bootstrap -->
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/popper.min.js"></script>

    <!-- fontawesome  -->
    <script src="assets/js/font-awesome.min.js"></script>

    <!-- swiper slider  -->
    <script src="assets/js/swiper-bundle.min.js"></script>

    <!-- mixitup -- filter  -->
    <script src="assets/js/jquery.mixitup.min.js"></script>

    <!-- fancy box  -->
    <script src="assets/js/jquery.fancybox.min.js"></script>

    <!-- parallax  -->
    <script src="assets/js/parallax.min.js"></script>

    <!-- gsap  -->
    <script src="assets/js/gsap.min.js"></script>

    <!-- scroll trigger  -->
    <script src="assets/js/ScrollTrigger.min.js"></script>

    <!-- scroll to plugin  -->
    <script src="assets/js/ScrollToPlugin.min.js"></script>

    <!-- smooth scroll  -->
    <script src="assets/js/smooth-scroll.js"></script>

    <!-- custom js  -->
    <script src="assets/js/main.js"></script>

</body>

</html>